// Code generated by protoc-gen-easymicro-jsonschema. DO NOT EDIT.
package main

import (
	"fmt"
	"log"

	"{{.ServiceClientImportPath}}"
	"github.com/995933447/runtimeutil"
	"github.com/invopop/jsonschema"
	jsoniter "github.com/json-iterator/go"
)

type ConfigSchemaOutput struct {
	Table string `json:"table"`
	IndexKeys []string `json:"index_keys"`
	UniqIndexKeys []string `json:"uniq_index_keys"`
	JsonSchema    *jsonschema.Schema`json:"json_schema"`
	Desc string `json:"desc"`
}

func main() {
	jsonSchema := getJsonSchema()
	configSchemaOutput := &ConfigSchemaOutput{
		Table:        {{ PathBase .ServiceClientImportPath }}.{{ .MessageName }}TbName,
		IndexKeys:    []string{
                      	{{- range .IndexKeys }}
                      	"{{ . }}",
                      	{{- end }}
                      },
		UniqIndexKeys: []string{
                       	{{- range .UniqIndexKeys }}
                       	"{{ . }}",
                       	{{- end }}
                       },
		JsonSchema: jsonSchema,
		Desc: "{{.Desc}}",
	}
	s, err := jsoniter.MarshalToString(configSchemaOutput)
	if err != nil {
		log.Fatal(runtimeutil.NewStackErr(err))
	}
	fmt.Print(s)
}

func getJsonSchema() *jsonschema.Schema {
	r := &jsonschema.Reflector{}
	r.DoNotReference = true
    r.AllowAdditionalProperties = true
    r.RequiredFromJSONSchemaTags = true
    r.FieldNameTag = "bson"
	return r.Reflect(&{{ PathBase .ServiceClientImportPath }}.{{ .MessageName }}Orm{})
}
